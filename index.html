<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Catalog</title>
    <link rel="icon" type="image/png" href="icon/32.png" />
    <style>
      /* ================= 1. Global Config ================= */
      :root {
        --header-height: 60px;
        --total-top-spacing: 60px;
        --sidebar-width: 300px;
        --accent-color: #000;
        --bg-color: #f8f8f8;
        --font-main: "Helvetica Neue", Helvetica, Arial, sans-serif;
        --tag-hot: #d9534f;
        --tag-new: #007bff;
        --tag-sale: #28a745;
      }

      /* ÈöêËóè‰ª∑Ê†ºÁõ∏ÂÖ≥ÂÖÉÁ¥† */
      .price-display,
      .discount-badge,
      .old-price,
      #wholesale-banner,
      .trust-section a {
        display: none !important;
      }
      .header-right {
        display: none !important;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        margin: 0;
        padding-top: var(--total-top-spacing);
        padding-bottom: 110px;
        font-family: var(--font-main);
        background: var(--bg-color);
        color: #333;
      }
      a {
        text-decoration: none;
        color: inherit;
        cursor: pointer;
      }
      button {
        outline: none;
        font-family: inherit;
        border: none;
        background: none;
        padding: 0;
      }

      /* HEADER */
      .site-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: var(--header-height);
        background-color: #000;
        color: #fff;
        display: flex;
        align-items: center;
        padding: 0 10px;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        gap: 10px;
      }
      .header-left {
        display: flex;
        align-items: center;
        gap: 5px;
        cursor: pointer;
        flex-shrink: 0;
      }
      .hamburger-icon {
        font-size: 1.6rem;
        line-height: 1;
      }
      .header-center {
        flex-grow: 1;
        display: flex;
        justify-content: flex-end;
      }
      .header-search-input {
        width: 100%;
        background: #333;
        border: 1px solid #444;
        color: #fff;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 0.9rem;
        outline: none;
      }

      /* SIDEBAR */
      .sidebar-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
      }
      .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        width: 85%;
        max-width: var(--sidebar-width);
        background: #fff;
        z-index: 2001;
        transform: translateX(-100%);
        transition: transform 0.3s;
        display: flex;
        flex-direction: column;
      }
      .sidebar.active {
        transform: translateX(0);
      }
      .sidebar-header {
        display: flex;
        border-bottom: 2px solid #ddd;
      }
      .sidebar-tab {
        flex: 1;
        text-align: center;
        padding: 15px 0;
        font-weight: 700;
        background: #f9f9f9;
      }
      .sidebar-tab.active {
        background: #fff;
        color: #000;
        border-bottom: 2px solid #000;
      }
      .sidebar-content {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
      }
      .menu-link {
        display: block;
        padding: 15px 0;
        font-weight: 600;
        border-bottom: 1px solid #eee;
        text-transform: uppercase;
      }
      .brand-item {
        padding: 12px 5px;
        font-size: 0.95rem;
        color: #555;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
      }

      /* BOTTOM NAV */
      .bottom-nav-bar {
        position: fixed;
        bottom: 25px;
        left: 50%;
        transform: translateX(-50%);
        width: 92%;
        max-width: 500px;
        height: 60px;
        background: #fff;
        z-index: 980;
        display: flex;
        align-items: stretch;
        justify-content: space-between;
        border-radius: 50px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(0, 0, 0, 0.03);
        overflow: hidden;
      }
      .nav-left {
        width: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        cursor: pointer;
        background: #fff;
      }
      .nav-badge {
        background-color: #000;
        color: #fff;
        font-size: 0.75rem;
        font-weight: 700;
        min-width: 22px;
        height: 22px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .nav-right {
        width: 50%;
      }
      .checkout-pill-btn {
        width: 100%;
        height: 100%;
        background-color: #000;
        color: #fff;
        font-size: 1rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        text-transform: uppercase;
      }

      /* CARDS */
      .brand-section {
        margin-bottom: 15px;
        background: #fff;
        padding: 15px 0 20px 0;
        border-top: 1px solid #eee;
        border-bottom: 1px solid #eee;
      }
      .brand-header {
        display: flex;
        justify-content: space-between;
        padding: 0 15px 10px;
      }
      .brand-title {
        font-size: 1.1rem;
        font-weight: 700;
        text-transform: uppercase;
      }
      .scroll-wrapper {
        display: flex;
        overflow-x: auto;
        gap: 12px;
        padding: 5px 12px 15px;
        scrollbar-width: none;
      }
      .scroll-card {
        flex: 0 0 160px;
        display: flex;
        flex-direction: column;
        cursor: pointer;
      }
      .img-wrapper {
        width: 100%;
        height: 160px;
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 8px;
        position: relative;
        background: #f4f4f4;
      }
      .img-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .badge-tag {
        position: absolute;
        top: 0;
        left: 0;
        color: #fff;
        padding: 3px 6px;
        font-size: 0.65rem;
        font-weight: bold;
      }
      .badge-hot {
        background: var(--tag-hot);
      }
      .badge-new {
        background: var(--tag-new);
      }
      .scroll-card-title {
        font-size: 0.85rem;
        height: 2.4em;
        overflow: hidden;
        line-height: 1.2;
        font-weight: 500;
        text-transform: uppercase;
      }
      .scroll-card-sub {
        font-size: 0.75rem;
        color: #888;
        margin-top: 2px;
      }

      /* BUTTONS */
      .action-btn-black {
        background: #000;
        color: #fff;
        padding: 10px 0;
        width: 100%;
        font-size: 0.8rem;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 700;
        text-transform: uppercase;
      }
      .action-qty-box {
        display: flex;
        align-items: center;
        justify-content: space-between;
        border: 2px solid #000;
        border-radius: 6px;
        height: 38px;
      }
      .qty-btn-rect {
        width: 35px;
        height: 100%;
        font-size: 1.2rem;
        background: #000;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }
      .qty-val-rect {
        flex: 1;
        text-align: center;
        font-weight: 700;
      }

      /* MODAL - ‰øÆÂ§ç‰∫ÜÂõæÁâáCSSÂíåNoteÊ†∑Âºè */
      .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        z-index: 3000;
        align-items: center;
        justify-content: center;
        padding: 15px;
      }
      .modal.open {
        display: flex;
      }
      .modal-content {
        background: #fff;
        width: 100%;
        max-width: 400px;
        border-radius: 12px;
        overflow: hidden;
        padding-bottom: 20px;
        position: relative;
      }
      .modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 2rem;
        cursor: pointer;
        z-index: 10;
        width: 40px;
        height: 40px;
        text-align: center;
        line-height: 40px;
      }

      /* ÂõæÁâá‰øÆÂ§çÔºöÂä†ÂõûÁÅ∞Ëâ≤ËÉåÊôØÂíåObject-fit */
      .modal-img {
        width: 100%;
        height: 300px;
        object-fit: contain;
        background: #f9f9f9;
        margin-bottom: 10px;
      }

      .modal-info {
        padding: 0 20px;
        text-align: center;
      }
      .modal-notes-box {
        font-size: 0.9rem;
        color: #555;
        background: #f4f4f4;
        padding: 8px 12px;
        border-radius: 6px;
        margin: 10px 0;
        font-style: italic;
        line-height: 1.4;
      }

      .stock-status {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.9rem;
        font-weight: bold;
        margin: 10px 0;
      }
      .stock-green {
        background: #e8f5e9;
        color: #2e7d32;
      }
      .stock-red {
        background: #ffebee;
        color: #c62828;
      }

      /* GRID VIEW */
      #grid-view {
        display: none;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px 10px;
      }
      .gallery {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      .item {
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #eee;
      }

      #toast {
        visibility: hidden;
        min-width: 200px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 30px;
        padding: 12px;
        position: fixed;
        z-index: 4000;
        left: 50%;
        bottom: 100px;
        transform: translateX(-50%);
        font-size: 0.9rem;
        opacity: 0;
        transition: 0.3s;
      }
      #toast.show {
        visibility: visible;
        opacity: 1;
        bottom: 110px;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="header-left" id="menu-trigger">
        <span class="hamburger-icon">‚ò∞</span>
      </div>
      <div class="header-center">
        <input
          type="text"
          id="global-search-input"
          class="header-search-input"
          placeholder="Search ID or Name..."
        />
      </div>
    </header>

    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-tab active">CATALOG</div>
      </div>
      <div class="sidebar-content">
        <nav>
          <a class="menu-link" onclick="handleMenuClick('Home')">Home</a>
          <a class="menu-link" onclick="handleMenuClick('All')">Full Catalog</a>
          <a
            class="menu-link"
            onclick="handleMenuClick('Gender:Women')"
            style="color: #c2185b"
            >For Her üë©</a
          >
          <a
            class="menu-link"
            onclick="handleMenuClick('Gender:Men')"
            style="color: #1565c0"
            >For Him üë®</a
          >
          <a class="menu-link" onclick="handleMenuClick('Gender:Unisex')"
            >Unisex ‚ö§</a
          >
          <a class="menu-link" onclick="handleMenuClick('Set')">Gift Sets üéÅ</a>
          <a class="menu-link" onclick="handleMenuClick('BestSellers')"
            >Best Sellers üî•</a
          >
          <a class="menu-link" onclick="handleMenuClick('New')"
            >New Arrivals üÜï</a
          >
          <a class="menu-link" href="cart.html">My Selection</a>
        </nav>
        <div style="font-weight: 700; margin: 20px 0 10px; color: #999">
          BRANDS
        </div>
        <div class="brand-list" id="brand-list-container"></div>
      </div>
    </div>

    <div id="home-view">
      <div id="home-content">
        <div style="text-align: center; padding: 40px">Loading Catalog...</div>
      </div>
    </div>

    <div id="grid-view">
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 15px;
        "
      >
        <div style="font-size: 1.2rem; font-weight: 700" id="grid-title">
          Results
        </div>
        <div
          onclick="handleMenuClick('Home')"
          style="text-decoration: underline"
        >
          Back
        </div>
      </div>
      <div class="gallery" id="gallery"></div>
      <div
        id="pagination-controls"
        style="margin-top: 20px; text-align: center"
      ></div>
    </div>

    <div id="modal" class="modal">
      <div class="modal-content">
        <div class="modal-close">&times;</div>
        <img id="modal-img" class="modal-img" src="" />
        <div class="modal-info">
          <div
            id="modal-sub"
            style="
              color: #888;
              font-size: 0.85rem;
              letter-spacing: 1px;
              text-transform: uppercase;
            "
          ></div>
          <h3
            id="modal-title"
            style="margin: 5px 0 10px; font-size: 1.2rem"
          ></h3>
          <div
            id="modal-sku"
            style="
              font-family: monospace;
              color: #555;
              background: #f0f0f0;
              display: inline-block;
              padding: 2px 6px;
              border-radius: 4px;
              font-size: 0.8rem;
            "
          ></div>

          <div
            id="modal-notes"
            class="modal-notes-box"
            style="display: none"
          ></div>

          <div id="modal-stock"></div>
          <div id="modal-action-area" style="margin-top: 15px"></div>
        </div>
      </div>
    </div>

    <div class="bottom-nav-bar">
      <div class="nav-left" onclick="window.location.href = 'cart.html'">
        <span style="font-weight: bold">SELECTION</span>
        <div id="bottom-bar-badge" class="nav-badge" style="display: none">
          0
        </div>
      </div>
      <div class="nav-right">
        <button
          class="checkout-pill-btn"
          onclick="window.location.href = 'cart.html'"
        >
          VIEW LIST &rarr;
        </button>
      </div>
    </div>

    <div id="toast">Added to Selection</div>

    <script src="db.js"></script>
    <script>
      // ================= CONFIG & CONSTANTS =================
      const FEATURED_BRANDS = [
        "Creed",
        "Dior",
        "Chanel",
        "Tom Ford",
        "Yves Saint Laurent",
        "Louis Vuitton",
        "Gucci",
        "Maison Francis Kurkdjian",
        "Parfums de Marly",
        "Jean Paul Gaultier",
        "Xerjoff",
        "Bond No. 9",
        "Initio",
      ];
      let cartItems = [];
      let viewMode = "home";
      let currentModalProductId = null;
      let currentGridData = [];
      let currentPage = 1;

      // ================= INIT =================
      document.addEventListener("DOMContentLoaded", () => {
        loadCart();
        setupMenu();
        renderSidebarBrands();
        setupSearch();
        setupModalClose();
      });

      // ================= URL SKU LOGIC =================
      window.checkSkuParam = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const sku = urlParams.get("sku");
        if (sku && window.perfumeDB) {
          const product = window.perfumeDB.find(
            (p) => p.id == sku || (p.id + "-" + p.name).startsWith(sku),
          );
          if (product) {
            openModal(product);
          }
        }
      };

      // ================= RENDER LOGIC =================
      function renderHome() {
        const db = (window.perfumeDB || []).filter(
          (p) => parseInt(p.stock) > 0,
        );
        const container = document.getElementById("home-content");
        container.innerHTML = "";

        const createSection = (title, items, filterKey) => {
          const section = document.createElement("div");
          section.className = "brand-section";
          section.id = "brand-" + (filterKey || title).replace(/\s+/g, "");

          section.innerHTML = `
            <div class="brand-header">
              <div class="brand-title">${title}</div>
              <div style="font-size:0.8rem; text-decoration:underline;" onclick="switchToGrid('${filterKey || "All"}')">See All</div>
            </div>
          `;

          const wrapper = document.createElement("div");
          wrapper.className = "scroll-wrapper";

          items.slice(0, 15).forEach((p) => {
            const card = document.createElement("div");
            card.className = "scroll-card";
            card.onclick = (e) => {
              if (
                e.target.closest(".action-btn-black") ||
                e.target.closest(".qty-btn-rect")
              )
                return;
              openModal(p);
            };

            const webp = p.img.replace(/\.(jpg|png|jpeg)$/i, ".webp");
            let badge = "";
            if (p.top == 1)
              badge = `<div class="badge-tag badge-hot">HOT</div>`;
            else if (p.new == 1)
              badge = `<div class="badge-tag badge-new">NEW</div>`;

            card.innerHTML = `
              <div class="img-wrapper">
                <picture><source srcset="${webp}"><img src="${p.img}" loading="lazy"></picture>
                ${badge}
              </div>
              <div class="scroll-card-title">${p.id} ${p.name}</div>
              <div class="scroll-card-sub">${p.brand}</div>
              <div style="margin-top:5px;" id="btn-home-${p.id}">${getButtonHtml(p.id)}</div>
            `;
            wrapper.appendChild(card);
          });
          section.appendChild(wrapper);
          container.appendChild(section);
        };

        const best = db.filter((p) => p.top == 1);
        if (best.length) createSection("üî• Best Sellers", best, "BestSellers");

        const nevv = db.filter((p) => p.new == 1);
        if (nevv.length) createSection("üÜï New Arrivals", nevv, "New");

        FEATURED_BRANDS.forEach((brand) => {
          const items = db.filter((p) =>
            p.brand.toLowerCase().includes(brand.toLowerCase()),
          );
          if (items.length >= 3)
            createSection(
              brand === "Yves Saint Laurent" ? "YSL" : brand.toUpperCase(),
              items,
              brand,
            );
        });
      }

      function renderGridPage() {
        const gallery = document.getElementById("gallery");
        gallery.innerHTML = "";

        const start = (currentPage - 1) * 20;
        const items = currentGridData.slice(start, start + 20);

        items.forEach((p) => {
          const div = document.createElement("div");
          div.className = "item";
          const webp = p.img.replace(/\.(jpg|png)$/i, ".webp");

          div.innerHTML = `
            <div style="height:180px; position:relative; overflow:hidden;" onclick="openModalById('${p.id}')">
               <picture><source srcset="${webp}"><img src="${p.img}" style="width:100%; height:100%; object-fit:cover;"></picture>
            </div>
            <div style="padding:10px;">
               <div style="font-weight:bold; font-size:0.9rem; height:2.4em; overflow:hidden;">${p.id} ${p.name}</div>
               <div style="color:#888; font-size:0.8rem; margin-bottom:5px;">${p.brand}</div>
               <div id="btn-grid-${p.id}">${getButtonHtml(p.id)}</div>
            </div>
          `;
          gallery.appendChild(div);
        });

        const totalPages = Math.ceil(currentGridData.length / 20);
        const controls = document.getElementById("pagination-controls");
        if (totalPages > 1) {
          controls.innerHTML = `
            <button onclick="changePage(-1)" style="padding:5px 10px; background:#ddd; margin-right:10px;">Prev</button>
            <span>Page ${currentPage} / ${totalPages}</span>
            <button onclick="changePage(1)" style="padding:5px 10px; background:#ddd; margin-left:10px;">Next</button>
          `;
        } else {
          controls.innerHTML = "";
        }
      }

      window.changePage = (delta) => {
        const total = Math.ceil(currentGridData.length / 20);
        const next = currentPage + delta;
        if (next >= 1 && next <= total) {
          currentPage = next;
          renderGridPage();
          window.scrollTo(0, 0);
        }
      };

      // ================= MODAL & ACTIONS =================
      window.openModal = (p) => {
        currentModalProductId = p.id;
        document.getElementById("modal-img").src = p.img;
        document.getElementById("modal-title").textContent = p.name;
        document.getElementById("modal-sub").textContent =
          p.brand + " ¬∑ " + (p.gender || "Unisex");
        document.getElementById("modal-sku").textContent = "SKU: " + p.id;

        // ‰øÆÂ§çÈ¶ôÂë≥ÔºöÂêåÊó∂Êü•ÊâæÂ§ßÂ∞èÂÜô
        const notes = p.Notes || p.notes || "";
        const notesEl = document.getElementById("modal-notes");
        if (notes) {
          notesEl.textContent = "Fragrance Notes: " + notes;
          notesEl.style.display = "block";
        } else {
          notesEl.style.display = "none";
        }

        // Â∫ìÂ≠òÈÄªËæë‰øÆÂ§ç
        const stockEl = document.getElementById("modal-stock");
        const stockNum = parseInt(p.inventory || p.stock); // Á°Æ‰øùÊòØÊï∞Â≠ó
        if (stockNum < 10) {
          stockEl.innerHTML = `<div class="stock-status stock-red">Low Stock: ${stockNum} Left</div>`;
        } else {
          stockEl.innerHTML = `<div class="stock-status stock-green">In Stock</div>`;
        }

        updateButtons(p.id);
        document.getElementById("modal").classList.add("open");

        const newUrl =
          window.location.protocol +
          "//" +
          window.location.host +
          window.location.pathname +
          "?sku=" +
          p.id;
        window.history.pushState({ path: newUrl }, "", newUrl);
      };

      window.openModalById = (id) => {
        const p = window.perfumeDB.find((x) => x.id == id);
        if (p) openModal(p);
      };

      function getButtonHtml(id) {
        const item = cartItems.find((c) => c.name === id);
        if (!item) {
          return `<button class="action-btn-black" onclick="updateItemQty('${id}', 1); event.stopPropagation();">SELECT ITEM</button>`;
        } else {
          return `
            <div class="action-qty-box" onclick="event.stopPropagation();">
              <div class="qty-btn-rect" onclick="updateItemQty('${id}', -1)">-</div>
              <div class="qty-val-rect">${item.quantity}</div>
              <div class="qty-btn-rect" onclick="updateItemQty('${id}', 1)">+</div>
            </div>`;
        }
      }

      window.updateItemQty = (id, delta) => {
        const product = window.perfumeDB.find((p) => p.id === id);
        let existing = cartItems.find((c) => c.name === id);

        if (!existing && delta > 0) {
          cartItems.push({
            name: id,
            caption: `${id} - ${product.name}`,
            img: product.img,
            brand: product.brand,
            quantity: 1,
          });
          showToast("Added to List");
        } else if (existing) {
          existing.quantity += delta;
          if (existing.quantity <= 0)
            cartItems = cartItems.filter((c) => c.name !== id);
        }

        saveCart();
        updateButtons(id);
        updateBottomBar();
      };

      function updateButtons(id) {
        const html = getButtonHtml(id);
        ["btn-home-", "btn-grid-"].forEach((prefix) => {
          const el = document.getElementById(prefix + id);
          if (el) el.innerHTML = html;
        });
        const modalArea = document.getElementById("modal-action-area");
        if (currentModalProductId === id && modalArea)
          modalArea.innerHTML = html;
      }

      // ================= UTILS & EVENTS =================
      function setupMenu() {
        document.getElementById("menu-trigger").onclick = () => {
          document.getElementById("sidebar").classList.add("active");
          document.getElementById("sidebar-overlay").classList.add("active");
        };
        document.getElementById("sidebar-overlay").onclick = () => {
          document.getElementById("sidebar").classList.remove("active");
          document.getElementById("sidebar-overlay").classList.remove("active");
        };
      }

      function setupModalClose() {
        document.querySelector(".modal-close").onclick = () => closeModal();
        document.getElementById("modal").onclick = (e) => {
          if (e.target.id === "modal") closeModal();
        };
      }

      function closeModal() {
        document.getElementById("modal").classList.remove("open");
        currentModalProductId = null;
        const cleanUrl =
          window.location.protocol +
          "//" +
          window.location.host +
          window.location.pathname;
        window.history.pushState({ path: cleanUrl }, "", cleanUrl);
      }

      function loadCart() {
        cartItems = JSON.parse(localStorage.getItem("perfumeCart") || "[]");
        updateBottomBar();
      }
      function saveCart() {
        localStorage.setItem("perfumeCart", JSON.stringify(cartItems));
      }

      function updateBottomBar() {
        const qty = cartItems.reduce((s, i) => s + i.quantity, 0);
        const badge = document.getElementById("bottom-bar-badge");
        if (qty > 0) {
          badge.textContent = qty;
          badge.style.display = "flex";
        } else {
          badge.style.display = "none";
        }
      }

      function showToast(msg) {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 2000);
      }

      function renderSidebarBrands() {
        const list = document.getElementById("brand-list-container");
        list.innerHTML = "";
        FEATURED_BRANDS.forEach((b) => {
          const div = document.createElement("div");
          div.className = "brand-item";
          div.textContent = b.toUpperCase();
          div.onclick = () => {
            switchToGrid(b);
          };
          list.appendChild(div);
        });
      }

      window.handleMenuClick = (key) => {
        document.getElementById("sidebar").classList.remove("active");
        document.getElementById("sidebar-overlay").classList.remove("active");
        if (key === "Home") {
          viewMode = "home";
          document.getElementById("home-view").style.display = "block";
          document.getElementById("grid-view").style.display = "none";
        } else {
          switchToGrid(key);
        }
      };

      window.switchToGrid = (key) => {
        viewMode = "grid";
        document.getElementById("home-view").style.display = "none";
        document.getElementById("grid-view").style.display = "block";

        let db = window.perfumeDB.filter((p) => parseInt(p.stock) > 0);
        let title = key;

        if (key === "All") title = "Full Catalog";
        else if (key.includes("Gender:")) {
          const g = key.split(":")[1];
          db = db.filter((p) => p.gender && p.gender.includes(g));
          title = g + " Selection";
        } else if (key === "BestSellers") {
          db = db.filter((p) => p.top == 1);
          title = "Best Sellers";
        } else if (key === "New") {
          db = db.filter((p) => p.new == 1);
          title = "New Arrivals";
        } else if (key === "Set") {
          db = db.filter((p) => p.name.includes("Set"));
          title = "Gift Sets";
        } else if (key.includes("Search:")) {
          const q = key.split(":")[1].toLowerCase();
          db = db.filter(
            (p) =>
              p.name.toLowerCase().includes(q) ||
              p.brand.toLowerCase().includes(q) ||
              p.id.toString().includes(q),
          );
          title = "Search: " + q;
        } else {
          db = db.filter((p) =>
            p.brand.toLowerCase().includes(key.toLowerCase()),
          );
        }

        currentGridData = db;
        currentPage = 1;
        document.getElementById("grid-title").textContent = title;
        renderGridPage();
        window.scrollTo(0, 0);
      };

      function setupSearch() {
        document
          .getElementById("global-search-input")
          .addEventListener("change", (e) => {
            switchToGrid("Search:" + e.target.value);
          });
      }
    </script>
  </body>
</html>
