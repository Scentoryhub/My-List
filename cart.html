<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Selection</title>
    <link rel="icon" type="image/png" href="icon/32.png" />
    <style>
      /* ================= RESET & GLOBAL ================= */
      :root {
        --header-height: 50px;
        --accent-color: #000;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 0;
        padding-top: var(--header-height);
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background: #f8f8f8;
        color: #333;
        padding-bottom: 100px;
      }

      /*HEADER*/
      .site-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: var(--header-height);
        background-color: #fff;
        color: #000;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 15px;
        z-index: 1000;
        border-bottom: 1px solid #eee;
      }
      .header-title {
        font-weight: 700;
        font-size: 1.1rem;
        text-transform: uppercase;
      }
      .back-btn {
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
      }

      /* CART LIST */
      #capture-area {
        max-width: 800px;
        margin: 0 auto;
        padding: 15px;
      }
      .cart-item {
        background: #fff;
        padding: 15px;
        display: flex;
        align-items: flex-start;
        border-radius: 8px;
        margin-bottom: 15px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }
      .cart-item-img {
        width: 60px;
        height: 60px;
        object-fit: contain;
        border-radius: 4px;
        background: #f9f9f9;
        margin-right: 15px;
      }
      .item-content {
        flex: 1;
      }
      .item-title {
        font-size: 0.95rem;
        color: #000;
        margin: 0 0 5px 0;
        line-height: 1.3;
        font-weight: 600;
      }
      .item-brand {
        font-size: 0.8rem;
        color: #666;
        margin-bottom: 8px;
      }

      /* QTY CONTROL */
      .qty-wrapper {
        display: flex;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: 100px;
        height: 32px;
      }
      .qty-btn {
        flex: 1;
        background: #fff;
        border: none;
        font-size: 1.1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .qty-display {
        flex: 1;
        text-align: center;
        line-height: 30px;
        font-weight: 600;
        font-size: 0.9rem;
        border-left: 1px solid #ddd;
        border-right: 1px solid #ddd;
      }

      /* EMPTY STATE */
      .empty-state {
        text-align: center;
        padding: 50px 20px;
        color: #999;
      }
      .btn-continue {
        display: inline-block;
        margin-top: 20px;
        background: #000;
        color: #fff;
        padding: 10px 25px;
        text-decoration: none;
        border-radius: 4px;
      }

      /* FOOTER ACTIONS */
      .cart-actions {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: #fff;
        padding: 15px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        display: flex;
        gap: 10px;
        flex-direction: column;
      }
      .total-qty-label {
        text-align: center;
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 5px;
      }
      .action-row {
        display: flex;
        gap: 10px;
      }
      .action-btn {
        flex: 1;
        padding: 14px;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        text-transform: uppercase;
      }
      .btn-clear {
        background: #f0f0f0;
        color: #333;
        flex: 0.4;
      }
      .btn-copy {
        background: #000;
        color: #fff;
        flex: 1;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="header-title">My Selection</div>
      <div class="back-btn" onclick="window.location.href = 'index.html'">
        âœ• Close
      </div>
    </header>

    <div id="capture-area">
      <ul
        id="cart-items-list"
        style="list-style: none; padding: 0; margin: 0"
      ></ul>
    </div>

    <div class="cart-actions" id="cart-footer" style="display: none">
      <div class="total-qty-label">Total Items: <b id="total-count">0</b></div>
      <div class="action-row">
        <button id="clear-btn" class="action-btn btn-clear">Clear</button>
        <button id="copy-btn" class="action-btn btn-copy">Copy List ðŸ“‹</button>
      </div>
    </div>

    <script>
      const cartList = document.getElementById("cart-items-list");
      const totalCountEl = document.getElementById("total-count");
      const footerEl = document.getElementById("cart-footer");

      function loadCart() {
        return JSON.parse(localStorage.getItem("perfumeCart") || "[]");
      }
      function saveCart(cart) {
        localStorage.setItem("perfumeCart", JSON.stringify(cart));
        window.dispatchEvent(new Event("storage"));
      }

      function renderCart() {
        const cart = loadCart();
        cartList.innerHTML = "";

        if (cart.length === 0) {
          footerEl.style.display = "none";
          cartList.innerHTML = `
            <div class="empty-state">
                <p>No items selected.</p>
                <a href="index.html" class="btn-continue">Browse Catalog</a>
            </div>`;
          return;
        }

        footerEl.style.display = "flex";
        let totalQty = 0;

        cart.forEach((item, index) => {
          totalQty += item.quantity;
          const li = document.createElement("li");
          li.className = "cart-item";
          li.innerHTML = `
            <img src="${item.img}" class="cart-item-img" alt="Product">
            <div class="item-content">
                <h3 class="item-title">${item.caption}</h3>
                <div class="item-brand">${item.brand || ""}</div>
                <div class="qty-wrapper">
                    <button class="qty-btn" onclick="updateQty(${index}, -1)">-</button>
                    <div class="qty-display">${item.quantity}</div>
                    <button class="qty-btn" onclick="updateQty(${index}, 1)">+</button>
                </div>
            </div>
            <div style="font-size:1.2rem; cursor:pointer; color:#ccc; margin-left:10px;" onclick="removeItem(${index})">&times;</div>
          `;
          cartList.appendChild(li);
        });

        totalCountEl.textContent = totalQty;
      }

      window.updateQty = (index, change) => {
        const cart = loadCart();
        if (cart[index]) {
          cart[index].quantity += change;
          if (cart[index].quantity <= 0) cart.splice(index, 1);
          saveCart(cart);
          renderCart();
        }
      };

      window.removeItem = (index) => {
        const cart = loadCart();
        cart.splice(index, 1);
        saveCart(cart);
        renderCart();
      };

      document.getElementById("clear-btn").onclick = () => {
        if (confirm("Clear selection?")) {
          localStorage.removeItem("perfumeCart");
          renderCart();
        }
      };

      // ================= COPY LOGIC =================
      document.getElementById("copy-btn").onclick = () => {
        const cart = loadCart();
        if (cart.length === 0) return;

        let msg = "Hi, here is my selection:\n\n";
        cart.forEach((item) => {
          msg += `â–«ï¸ ${item.caption} x ${item.quantity}\n`;
        });
        msg += `\nTotal Items: ${document.getElementById("total-count").textContent}`;

        navigator.clipboard
          .writeText(msg)
          .then(() => {
            const btn = document.getElementById("copy-btn");
            const originalText = btn.textContent;
            btn.textContent = "Copied! âœ…";
            btn.style.background = "#28a745";
            setTimeout(() => {
              btn.textContent = originalText;
              btn.style.background = "#000";
            }, 2000);
            alert("List copied! Now paste it to your reseller.");
          })
          .catch((err) => {
            console.error("Failed to copy: ", err);
            alert("Failed to copy automatically. Please take a screenshot.");
          });
      };

      document.addEventListener("DOMContentLoaded", renderCart);
    </script>
  </body>
</html>
